# Правила и соглашения по разработке игры на Babylon.js

Этот документ определяет основные правила и стандарты, которым нужно следовать при разработке проекта. Он основан на плане из файла `TASKS.md` и учитывает текущее состояние проекта.

## 0. Правила для ИИ-ассистента

*   **0.1. Совместимость:** ВСЕГДА сохранять существующую функциональность. Не ломать работающий код.
*   **0.2. Масштабирование:** Использовать `scaleFactor = 10` для всех размеров и расстояний в игре.
*   **0.3. Паттерны:** Следовать существующим паттернам:
    *   `inputMap` для отслеживания клавиш
    *   `scene.onBeforeRenderObservable` для игровой логики
    *   `camera.target.copyFrom(sphere.position)` для следования камеры
*   **0.4. Производительность:** Избегать тяжелых операций в render loop (60 FPS).
*   **0.5. Комментарии:** Комментировать сложную физику и математические расчеты.
*   **0.6. Тестирование:** После изменений проверять основные функции: движение, прыжки, камера, коллизии.

## 1. Структура проекта

*   **1.1. Организация папок:** Соблюдать строгую и логичную структуру папок для исходного кода, ассетов и других файлов.
    *   `src/` или `js/`: для всего исходного кода JavaScript/TypeScript.
    *   `src/components/`: для переиспользуемых компонентов (например, `PlayerController.ts`, `EnemyAI.ts`).
    *   `src/scenes/`: для каждого игрового уровня или сцены (например, `MainMenuScene.ts`, `Level1Scene.ts`).
    *   `assets/`: для всех игровых ресурсов.
        *   `assets/models/`: для 3D-моделей (`.glb`, `.gltf`).
        *   `assets/textures/`: для текстур (`.png`, `.jpg`).
        *   `assets/sounds/`: для звуковых эффектов и музыки (`.mp3`, `.wav`).
    *   `ui/` или `css/`: для файлов, связанных с пользовательским интерфейсом (HTML/CSS).

*   **1.2. Именование файлов:** Использовать `PascalCase` для классов и компонентов (`PlayerController`) и `camelCase` для остальных файлов и переменных (`playerSpeed`).

## 2. Код и архитектура

*   **2.1. Модульность:** Каждый класс или файл должен выполнять одну конкретную задачу. Логика игрока, врагов, UI и сцен должна быть разделена.
*   **2.2. Конфигурация:** Не "хардкодить" значения. Параметры, которые могут меняться (скорость игрока, урон врага, время появления), выносить в отдельные объекты или файлы конфигурации.
*   **2.3. Комментарии:** Комментировать только сложную или неочевидную логику. Объяснять "почему" код написан так, а не "что" он делает.
*   **2.4. Сцены:** Каждая сцена (главное меню, уровень 1, экран "Game Over") должна быть в своем собственном классе, который управляет всеми объектами на этой сцене.

## 3. Работа с ассетами

*   **3.1. Оптимизация:** Все ассеты должны быть оптимизированы для веба *перед* добавлением в проект.
    *   **Модели:** Низкое количество полигонов.
    *   **Текстуры:** Сжатые форматы и разумные разрешения (например, не больше 1024x1024 для большинства объектов).
*   **3.2. Форматы:** Придерживаться единых форматов: `.glb` для моделей (так как он включает текстуры), `.png` для текстур с прозрачностью, `.jpg` для остальных, `.mp3` для музыки.

## 4. Управление и игровая механика

*   **4.1. Разделение ввода и действия:** Код, который считывает ввод с клавиатуры/мыши, должен быть отделен от кода, который выполняет действие персонажа. Это упростит добавление поддержки геймпада в будущем.
*   **4.2. Интерактивные объекты:** Создать базовый класс или интерфейс для всех объектов, с которыми можно взаимодействовать (например, `IInteractable`), с методами `onInteract()`, `onCollision()`.

## 5. Контроль версий (Git)

*   **5.1. Коммиты:** Делать небольшие, атомарные коммиты. Каждый коммит должен решать одну задачу.
*   **5.2. Сообщения коммитов:** Писать осмысленные сообщения. Например: `feat: Add player jump mechanics` или `fix: Correct collision detection with walls`.
*   **5.3. Ветки:** Новую функциональность разрабатывать в отдельных ветках, а не в `main`.

## 6. Текущее состояние проекта (для ИИ)

*   **6.1. Архитектура:** Монолитная структура в `js/main.js` (195 строк). Требует рефакторинга на модули.
*   **6.2. Основные компоненты:**
    *   Персонаж: сфера с физикой и коллизиями
    *   Мир: загружается из `assets/textures/core/hq_bellato.glb`
    *   Камера: ArcRotateCamera с ограничениями радиуса
    *   Управление: WASD + мышь + пробел + E/Q (полет)
*   **6.3. Известные проблемы:**
    *   Дублированная кнопка "Toggle Fly Mode" в HTML
    *   Отсутствие модульности кода
    *   Нет системы конфигурации
*   **6.4. Ключевые переменные:**
    *   `scaleFactor = 10` - универсальный масштаб
    *   `playerSpeed = 0.3 * scaleFactor` - скорость движения
    *   `jumpForce = 0.2 * scaleFactor` - сила прыжка
    *   `gravity = -0.015 * scaleFactor` - гравитация
*   **6.5. Приоритеты развития:**
    1. Исправить дублированную кнопку
    2. Рефакторинг на модули
    3. Добавить анимации и звук
    4. Реализовать игровые механики
